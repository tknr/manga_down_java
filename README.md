=================================================
ソフト名       ：漫画図書館ZダウンローダJava
バージョン    ： 1.0.3
動作環境     ：Javaが動くPC。
MacOSX、Winodows7、Windows8、Windows10、MacOSX、Linuxなど
ライセンス   　 ：フリーソフト。
必要なランタイムなど ：Java、ffmpeg
=================================================
■このソフトの説明
漫画図書館Zの画像ダウンローダです。

1.漫画図書館Zの漫画単体の画像を一括で落とします。
2.漫画図書館Zの検索キーワードに検出された漫画を一括で落とします。
3.漫画図書館Zの特定タグの漫画を一括で落とします。
4.広告や周りの余分な空白を無くす為に、
キャプチャーした画像から指定範囲を切り取る機能。
2ページを左右2枚の画像ファイルで切り取ることも可能。
5.ファイル名の前に00を付ける機能。
6.漫画を一つのpdfに書き出す機能。

seleniumを使ってページ移動して画像キャプチャーで画像を保存します。



■Windows XP、Windows Vistaでの動作について

今、私に確認できるPC環境が無いので確認してないし断言はできませんが、
chromeの最新版がインストールできないので無理らしい。


■LinuxとMacOSXでの動作について

動作確認はしてませんが、
使えると思います。
chromedriverをインストールしてください。

■使い方

chromeをインストールしてなかったら
chromeをインストールしてください。

chromeを起動してる場合は閉じてください。
chromeが起動してると使えないです。

chromeにAdblock Plusをインストールする。
https://chrome.google.com/webstore/detail/adblock-plus/cfhdojbkjhnklbpkdaibdccddilifddb?hl=ja
広告があると読み込みに時間が掛かる&キャプチャーすると広告も入るので必然です。
漫画図書館Zの広告を消せる拡張ならAdblock Plusじゃなくても何でも良いです。

chromeのuser-data-dirのパスを
設定タブの「user-data-dirのパス」に設定。

■漫画単体の落とし方

「機能の選択」で「単体」をチェック。

漫画単体のurlをメインタブのurlに入れる。
例えば以下のurl。
https://www.mangaz.com/series/detail/161141
以下のurlでもかまいません。urlは自動修正されます。
https://vw.mangaz.com/navi/161141
https://vw.mangaz.com/virgo/view/161141/i:0

「開始」ボタンを押す。
そうするとchromeが起動してキャプチャーが始める。
最後のページに行くと自動で終了します。

画像の大きさはPCの画像の解像度の設定で変わります。


■タグ/検索キーワードの落とし方
「機能の選択」で「タグ/検索」をチェック。

メインタブのurlに検索キーワードのurlを入れる。
urlは例えば以下です。
https://www.mangaz.com/title/index?query=%E3%81%8A%E8%89%B2%E6%B0%97
https://www.mangaz.com/title/index?query=4%E3%82%B3%E3%83%9E
https://www.mangaz.com/title/index?query=%E5%AD%A6%E5%9C%92
https://www.mangaz.com/title/index?query=%E3%82%AE%E3%83%A3%E3%82%B0

開始ボタンを押す。

このソフトは一覧ページをseleniumで取得します。
ENDキーを送信して最後までスクロールしてから
落とすので、全ての漫画を取得できます。

全て取得して一番下に行くまで
ENDキーを連続で送信します。
ENDキーを送信する間隔は、
設定2タブの「ENDキーを送信する間隔」に設定してください。

自分の環境に合わせて調節してください。
単位はミリ秒です。
5000なら5秒に一度送信します。

ENDキーを送信してスクロールしてる間は、
「ヘッドレスモードにする(非推奨)」をチェックしてると、
経過表示が無いので注意。
チェックを外してるほうが何をやってるのか分かりやすいです。

■特定シリーズの落とし方
「機能の選択」で「タグ/検索」をチェック。

メインタブのurlに検索キーワードのurlを入れる。
urlは例えば以下です。
https://www.mangaz.com/series/detail/101

■カテゴリーの落とし方

「機能の選択」で「タグ/検索」をチェック。

メインタブのurlにカテゴリーのurlを入れる。
urlは例えば以下です。
https://www.mangaz.com/mens/title/index?type=upload&category=mens

以下のurlではないので注意。
https://www.mangaz.com/mens/
「投稿作品をもっと見る」を押した後のurlです。

■pdf出力機能

設定2タブの[pdfを作成する]をチェックで有効。

複数の画像を1つの（複数ページの）pdfで保存します。
pdfのページ数は画像の枚数と同じになります。
pdfのファイル名は漫画のタイトル名になります。
保存フォルダでなくカレントディレクトリに出力されます。

画像出力サイズは、出力されるpdfのサイズです。
このソフトは画像のサイズをpdfのサイズに合わせて
拡大縮小する機能は無いので、
画像に合ったサイズを選択して下さい。
小さいと画像がはみ出ます。
サイズの規格はA4とかA6とかと同じです。
サイズはAの隣のテキストフィールドに0〜9までの数字を入れます。

「画像開始位置」は画像が開始する位置です。
画像を真ん中にするのに設定が必要になります。
「x軸（左端から）」は左端からの数値です。
「y軸（下）」は下端からの数値です。
上からでなく下から始まるので注意。
分からなければ0を入れれば良いです。


■「プロセスにchromeがある場合に強制終了させる」チェックについて

このソフトはプロセスにchromeがあると使えないので、
自動で強制終了できる機能です。

「開始」ボタンを押した時に、
プロセスを検索してプロセスにchrome.exeがあると、
(LinuxやMacOSXだとchrome）
chrome.exeを強制終了させます。

chrome.exeという別のソフトがある可能性もあるので、
設定で無効にできます。

chromeでフォーム入力中やブラウザゲーム中などの時に、
このソフトを開始したとこで、
chromeが強制終了されたとしても自己責任でお願いします。

■切り取り機能。
広告や周りの余分な空白を無くす為に、
画像の範囲を指定して切り取る機能です。
 
「画面切り取り設定」の「一枚で切り取る」をチェックで有効。
有効にすると指定範囲を切り取れる。

「切り取り開始位置」は画像が開始する位置です。
「x軸」は左端からの数値です。
「y軸」は上端からの数値です。

「切り取り開始位置」の「X軸」に画像が開始するX軸の数値を入れてください
「切り取り開始位置」の「Y軸」 に画像が開始するY軸の数値を入れてください。

「切り取り画像サイズ」の「width」は画像の横幅です。
「height」は画像の縦幅です。

x軸設定の数値+width設定の数値が元画像のwidthを超えないようにしてください。
y軸設定の数値+height設定の数値が元画像のheightを超えないようにしてください。



■切り取り機能。

広告や周りの余分な空白を無くす為に、
画像の範囲を指定して切り取る機能です。
 
「画面切り取り設定」の「一枚で切り取る」をチェックで有効。
有効にすると指定範囲を切り取れる。

「切り取り開始位置」は画像が開始する位置です。
「x軸」は左端からの数値です。
「y軸」は上端からの数値です。

「切り取り開始位置」の「X軸」に画像が開始するX軸の数値を入れてください
「切り取り開始位置」の「Y軸」 に画像が開始するY軸の数値を入れてください。

「切り取り画像サイズ」の「width」は画像の横幅です。
「height」は画像の縦幅です。

x軸設定の数値+width設定の数値が元画像のwidthを超えないようにしてください。
y軸設定の数値+height設定の数値が元画像のheightを超えないようにしてください。


「切り取り後のheightを元画像と同じにする」チェックは有効にすると、
height設定を画像のheightと同じにします。
その場合、開始y軸設定は0になります。
上下を切り取らないで左右だけ切り取る場合は有効にしてください。

■2ページを2枚で切り取る機能
 
「画面切り取り設定」の「左右二枚で切り取る」をチェックで有効。
有効にすると指定範囲を切り取れる。
2ページを2枚で切り取れる。

「切り取り開始位置」は画像が開始する位置です。
「x軸」は左端からの数値です。
「y軸」は上端からの数値です。
「切り取り開始位置」の「x軸」と「y軸」は1枚目の設定です。

「切り取り開始位置」の「X軸」に画像が開始するX軸の数値を入れてください
「切り取り開始位置」の「Y軸」 に画像が開始するY軸の数値を入れてください。

「切り取り画像サイズ」の「width」は画像の横幅です。
「height」は画像の縦幅です。
「width」と「height」は2枚の画像で同じです。

x軸設定の数値+width設定の数値+width設定の数値が元画像のwidthを超えないようにしてください。
y軸設定の数値+height設定の数値が元画像のheightを超えないようにしてください。

画像を二枚で切り出すますが、
二枚目の開始x軸=1枚目のx軸+widthになります。
二枚の画像で書きだされるので、
widthは二枚入るように小さくしないといけないです。

width+width+開始X軸が画像のwidthを超えてはいけません。


「切り取り後のheightを元画像と同じにする」チェックは有効にすると、
height設定を画像のheightと同じにします。
その場合、開始y軸設定は0になります。
上下を切り取らないで左右だけ切り取る場合は有効にしてください。


■ページの前に00を入れる

「ページの前に00を入れる」をチェックすると、
例えばファイル名が1.pngだと001.pngに
11.pngだと011.pngになります。

■waitについて

設定タブの「wait」にwaitを設定できます。
単位はミリ秒単位です。
キャプチャー前に入ります。

ロード画像が表示されて漫画画像が表示されない画像がある場合は、
waitを増やして調節してください。


■ヘッドレスモード

chromeが出るのが嫌いな人は、
ヘッドレスモードにもできる。
「ヘッドレスモードにする(非推奨)」をチェックで有効。

ヘッドレスモードは推奨しません。
ヘッドレスモードだと何故かusr-dirが反映されなかったので、
adblockが機能しないで広告が出るからです。


■「kill」ボタンについて

メインタブの「kill」ボタンはプロセスを検索して、
プロセスにchromedriver.exeが
あった場合に自動で強制終了する機能です。
（LinuxやMacの場合、chromedriver）

chromedriver.exeは終了しないでプロセスに残って溜まることが
あるようなのですが、タスクマネージャーから終了するのは面倒だから、
強制終了できる機能を付けた。

■「chromedriverがプロセスに残った場合に自動kill」
「chromedriverがプロセスに残った場合に自動kill」は
全ての作業が終わったタイミングでchromedriverのプロセスを探して、
見つかった場合に自動で強制終了します。



■seleniumについて


seleniumでブラウザはchromeを使用します。
chromedriverのパスの設定は省略してあるのでカレントディレクトリにchromedriverがあれば良いです。
windowsの場合はchromedriver.exeがmangaz_down.jarと同じフォルダにあれば良いです。
LinuxやMacOSXの場合はchromedriverをインストールして、パスを通せば良いです。



■user-data-dirのパスについて

設定タブの「user-data-dir」にchromeのuser-data-dirを指定してくだあい。
C:/Users/user_name/\AppData/Local/Google/ChromevUser Data/
です。

分からなくても起動時に空だと自動でデフォルトのパスが入力されます。
「自動入力」ボタンも同じです。

seleniumでchromeを動かすとクッキーが何も無いデフォルトの状態で
起動するのですが、そうするとtwitterにログインできてないです。
このソフトはその問題を解決する為に、
user-data-dirのパスを指定してseleniumでchromeを動かしてます。
user-data-dirのパスを指定すると、普段使ってるchromeのクッキーが
使えるようになるのでアンケートの画面がでなくなるのです。

user-data-dirのパスを指定した場合、seleniumでchromeを動かしてる時に、
chrome（seleniumでなく普通のchrome)を起動して動かすと、
エラーが出てseleniumでurlの抽出ができなくなります

「org.openqa.selenium.WebDriverException: unknown error: Chrome failed to start: crashed」というエラーが出たらそれです。

このソフトを使う時はchrome（seleniumでなく普通のchrome)を同時に使わないでください。



■バッチ処理機能について

複数のurlを一括で順番にダウンロードする機能です。

この機能に関してはまだ確認してないです。


■保存ディレクトリのパスについて
設定タブの保存ディレクトリのパスのテキストフィールドに
保存するディレクトリのパスを入れます。
何も入れないとカレントディレクトリに保存されます。

パスは最後は必ず/を入れてください。

テキストフィールドにD&Dでも設定できます。
「開く」ボタンでも設定できます。

■保存ディレクトリのパスの下のコンボボックスについて

保存ディレクトリのパスの下のコンボボックスは
ホームディレクトリのDownloadsやPicturesディレクトリが入ってます。
英語と日本語があるのはLinuxのディストリビューションによって日本語のがあるから。
自分の環境に合わせて選択して下さい。
セレクトすると、保存ディレクトリのテキストフィールドに自動で挿入されます。



■重複ハッシュDB機能について

DBを使い重複画像を自動で削除する機能です。
「落とす画像」でorig、largeなどを複数チェックしてる場合、
重複画像が出るのでこの機能を使うと良いです。
一つだけをチェックする場合は必要無いです。

画像のハッシュをDBに記録し、
画像を落とした時に画像のハッシュがDBにあるかチェックし、
無ければDBにハッシュを追加します。
あれば画像を削除します。

DBはSQLiteを使います。
SQLiteはサーバー不要で一つのファイルでDBになります。

DBファイルはzipに入れてます。
hash.dbがDBファイルです。
テーブルは作成済みです。
hash.dbを好きなフォルダに入れて、
hash.dbのパスを設定タブの「DBのパス」に入れます。
テキストフィールドにDBをD&Dで設定可能。
「開く」ボタンでも設定できる。
設定2タブの「重複ハッシュDB機能」をチェックします。
これで使えます。

設定2タブの「DBを初期化」ボタンは押すと、
hash.dbの全レコードを一括削除します。

設定2タブの「db初期化設定」の
「開始時に初期化」をチェックすると、開始ボタンを押した時に自動で
hash.dbが初期化(全レコード削除）されます。 
「db初期化設定」の
「アカウントごとに初期化」をチェックすると、
バッチ処理時のアカウントごとに自動で
DBが初期化(全レコード削除）されます。

■look and feelについて

ソフトの外観のデザインを自由に変更できます。
外観タブの「look and feelの選択」でチェックし、
「外観を変更」ボタンで変更します。
起動時にその外観にするには「設定保存」ボタンを押してください。

Windowsの場合は選択できるのは、
Nimbus、metal、motif、windows、windowsクラシックです。
GTKとMacは使えないので設定しないでください。
(windows8はwindowsクラシックは使えないかも）

Linuxの場合はGTKが使えます。
Linuxは他に、たぶん、Nimbus、metal、motifが選択できるかと思います。

Macは確認してませんがNimbus、metal、motif、Macが選択できるのではないかと思います。

システム標準はシステム標準の外観になります。

「カスタム」はlook and feel名で自由に設定できます。
「カスタム」をチェックしlook and feel名に名前を入れてください。

デフォルトはNimbusです。
動作確認してるのはNimbusのみです。、

■設定ファイルについて

このソフトではホームディレクトリに設定ファイルを起いて、
設定を読み書きします。設定ファイルはxmlです。
チェックやテキストフィールドの文字列が保存されます。

ホームディレクトリ/ユーザー名/に
.melon_koukouディレクトリが作られて、
そのディレクトリの中のmangaz_down.xmlが設定ファイルです。

設定ファイルの場所はホームディレクトリ/ユーザー名/.melon_koukou/mangaz_down.xmlになります。

設定ファイルは自動では作成されません。
設定保存タブの「設定保存」ボタンを押さないと作成されないので、
「設定保存」ボタンを押して下さい。

「設定読み込み」ボタンを押すと設定が読み込まれます。

「起動時設定読み込み」チェックは入れてから、
「設定保存」ボタンで設定を保存すると、
起動時に自動で設定読み込みがされます。

「設定ファイル削除」ボタンを押すと設定が削除されます。

「閉じる時に設定保存」はチェックすると、
ソフトを閉じる時に自動で設定保存します。


■別途必要なソフト
Java

■開発環境
Winodows7(64bit)
netbeans

■動作環境
Javaが動くデスクトップPC。
MacOSX、inodows7、
Windows8、Winodows10、MacOSX、Linuxなど

■インストール
jarファイルを任意のフォルダに入れる。


■アンインストール
jarファイルを削除してください。

削除する必要は無いのですが、
不要なゴミは邪魔になるから削除したいっていう人は、
ホームディレクトリ/ユーザー名/.melon_koukou/mangaz_down.xml
を削除してください。ソフト上から「設定ファイル削除」でできます。


★更新履歴
2018/9/22　ver1.0.3
pdf出力機能。
2018/9/22　ver1.0.2
画像を切り取る機能。
2018/9/21　ver1.0.1
2018/9/20　ver1.0.0

初公開
